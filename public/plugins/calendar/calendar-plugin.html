<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../bower_components/polymer-filters/polymer-filters.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../home-container.html">
<link rel="import" href="../../elements/member-select/member-select.html">
<link rel="import" href="../../elements/datetime-input/datetime-input.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/core-pages/core-pages.html">
<link rel="import" href="../../bower_components/core-style/core-style.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-up.html">

<core-style id="calendar">
    paper-tabs::shadow #selectionBar{
    background-color: {{g.theme.accentBgColor}};
    }
    paper-tabs paper-tab::shadow #ink {
    color: {{g.theme.accentBgColor}};
    }
    paper-toggle-button::shadow #toggleBar[checked], paper-toggle-button::shadow paper-radio-button::shadow #onRadio {
    background-color: {{g.theme.accentBgColor}};
    }
    :host {
    background-color: white;
    }
    div.container {
    padding: 1em;
    overflow-y: auto;
    overflow-x: hidden;
    }

    div.timeline {
    position: relative;
    padding: 2em 0;
    margin-top: 2em;
    margin-bottom: 2em;
    }
    div.timeline::before {
    content: '';
    position: absolute;
    top: 0;
    left: 18px;
    height: 100%;
    width: 4px;
    background-color: {{g.theme.thirdBgColor}};
    }

    .content {
    margin-left: 40px;
    }
    .block {
    position: relative;
    margin: 4em 0;
    cursor: pointer;
    }

    .time {
    margin-top: 4px;
    }

    p.description {
    margin-bottom: 0;
    }

    div.detail {
    padding: 60px;
    overflow-y: auto;
    }

    .main-button {
    position: absolute;
    top: 8px;
    left: 8px;
    }

    .tabs, .pages, .fullday {
    max-width: 320px;
    }

    .fullday {
    margin: 1em 0;
    }

    .event {
    border-radius: 50%;
    padding:8px;
    }
    time-input.upper {
    margin-top: -35px;
    }
    date-input {
    z-index: 1;
    }
    #title {
        font-size: 25px;
    }
    .page.core-selected {
        position: relative;
        display: block;
    }
</core-style>

<polymer-element name="schedule-list">
    <template>
        <core-style ref="theme"></core-style>
        <core-style ref="calendar"></core-style>
        <core-animated-pages selected="0" transitions="cross-fade-all slide-up" id="pages" flex>
            <section>
                <div class="container" fit>
                    <div class="timeline">
                        <template repeat="{{event, index in events}}">
                            <div layout horizontal class="block" center on-tap="{{select}}">
                                <div class="event mainColor">
                                    <core-icon icon="event"></core-icon>
                                </div>
                                <div hero hero-id="{{event.id}}" vertical layout flex class="content">
                                    <div>{{event.title}}</div>
                                    <div class="time iconColor">{{event.time | date('HH:mm')}}</div>
                                </div>
                                <!--<div class="info">-->
                                <!--<core-icon icon="info" class="iconColor"></core-icon>-->
                                <!--</div>-->
                                <paper-ripple fit></paper-ripple>
                            </div>
                        </template>
                    </div>
                </div>
            </section>
            <section>
                <div hero hero-id="{{selected.id}}" class="detail" vertical layout fit center slide-up>
                    <paper-icon-button icon="arrow-back" class="main-button" on-tap="{{main}}"></paper-icon-button>
                    <div class="detail-content" vertical layout center>
                        <div>
                            <paper-input label="Title" floatingLabel value="{{selected.title}}" id="title"
                                         disabled="{{modeDisabled}}"></paper-input>
                            <paper-input-decorator label="Description" floatingLabel id="decorator"
                                                   disabled="{{modeDisabled}}">
                                <paper-autogrow-textarea id="autogrowArea">
                                    <textarea id="textArea" wrap="virtual" value="{{selected.description}}"
                                              disabled?="{{modeDisabled}}"></textarea>
                                </paper-autogrow-textarea>
                            </paper-input-decorator>
                            <template if="{{!modeDisabled}}">
                                <div center horizontal layout class="fullday">
                                    <div flex>Full Day</div>
                                    <paper-toggle-button checked="{{fullDay}}"
                                                         disabled="{{modeDisabled}}"></paper-toggle-button>
                                </div>
                                <paper-tabs selected="{{tabSelected}}" class="tabs">
                                    <paper-tab>Period</paper-tab>
                                    <paper-tab>Point</paper-tab>
                                </paper-tabs>
                            </template>
                            <core-pages selected="{{tabSelected}}" class="pages">
                                <div class="page">
                                    <div layout horizontal justified end>
                                        <div layout vertical>
                                            <date-input label="From" disabled="{{modeDisabled}}"></date-input>
                                            <template if="{{!fullDay}}">
                                                <time-input class="upper" disabled="{{modeDisabled}}"></time-input>
                                            </template>
                                        </div>
                                        <div layout vertical>
                                            <date-input label="To" disabled="{{modeDisabled}}"></date-input>
                                            <template if="{{!fullDay}}">
                                                <time-input class="upper" disabled="{{modeDisabled}}"></time-input>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                <div class="page">
                                    <div layout horizontal justified end>
                                        <date-input label="Date" disabled="{{modeDisabled}}"></date-input>
                                        <template if="{{!fullDay}}">
                                            <time-input label="Time" disabled="{{modeDisabled}}"></time-input>
                                        </template>
                                    </div>
                                </div>
                            </core-pages>
                            <member-select teamsUrl="/platform/teams_users" disabled="{{modeDisabled}}"></member-select>
                        </div>
                    </div>
                </div>
            </section>
        </core-animated-pages>
    </template>
    <script>
        Polymer({
            modeDisabled: true,
            tabSelected: 0,
            events: [
                {
                    id: "1",
                    title: "Event Title 1",
                    description: "Event description 1",
                    time: new Date()
                }, {
                    id: "2",
                    title: "Event Title 2",
                    description: "Event description 2",
                    time: new Date()
                }, {
                    id: "3",
                    title: "Event Title 3",
                    description: "Event description 3 a little long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long",
                    time: new Date()
                }, {
                    id: "4",
                    title: "Event Title 3",
                    description: "Event description 3 a little long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long",
                    time: new Date()
                }, {
                    id: "5",
                    title: "Event Title 3",
                    description: "Event description 3 a little long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long",
                    time: new Date()
                }, {
                    id: "6",
                    title: "Event Title 3",
                    description: "Event description 3 a little long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long",
                    time: new Date()
                }
            ],
            selectes: {},
            select: function (event, detail, target) {
                this.selected = target.templateInstance.model.event;
                this.modeDisabled = true;
                var self = this;
                setTimeout(function () {
                    self.$.autogrowArea.update(self.$.textArea);
                    self.$.decorator.updateLabelVisibility(self.$.textArea.value);
                    self.$.pages.selected = 1;
                }, 100);

            },
            main: function () {
                this.$.pages.selected = 0;
            },
            jumpToAdd: function () {
                this.selected = {};
                this.modeDisabled = false;
                var self = this;
                setTimeout(function () {
                    self.$.autogrowArea.update(self.$.textArea);
                    self.$.decorator.updateLabelVisibility(self.$.textArea.value);
                    self.$.pages.selected = 1;
                }, 100);
            }
        });
    </script>
</polymer-element>

<polymer-element name="calendar-plugin">
    <template>
        <core-style ref="theme"></core-style>
        <style>
            #timeline {
                position: relative;
                padding: 2em 0;
                margin-top: 2em;
                margin-bottom: 2em;
            }

            #timeline:before {
                content: '';
                position: absolute;
                top: 0;
                left: 18px;
                height: 100%;
                width: 4px;
                background: #d7e4ed;
            }

            paper-fab {
                position: absolute;
                left: 16px;
                top: -20px;
                z-index: 1000000000;
            }

            schedule-list {
                margin-top: 50px;
            }

            .subTitle {
                font-size: 21px;
                margin-left: 50px;
                padding-bottom: 10px;
            }

            .container {
                position: relative;
            }

            paper-fab {
                position: relative;
                top: 44px;
            }

            .wrapper {
                padding-bottom: 20px;
            }
        </style>
        <home-container>
            <div layout vertical fit>
                <div class="mainColor wrapper">
                    <paper-fab mini icon="add" class="accentColor" on-tap="{{addEvent}}"></paper-fab>
                    <span class="subTitle">Schedule</span>
                </div>
                <schedule-list flex vertical layout id="schedule"></schedule-list>
            </div>
            <!-- cd-timeline -->
        </home-container>
    </template>
    <script>
        Polymer({
            addEvent: function () {
                this.$.schedule.jumpToAdd();
            }
        });
    </script>
</polymer-element>