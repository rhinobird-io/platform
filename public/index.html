<!DOCTYPE html>
<html>
<head>
    <!-- 1. Load platform support before any code that touches the DOM. -->
    <script src="bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <!-- 2. Load the component using an HTML Import -->
    <link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
    <link rel="import" href="bower_components/core-menu/core-menu.html">
    <link rel="import" href="bower_components/core-list/core-list.html">
    <link rel="import" href="bower_components/core-item/core-item.html">
    <link rel="import" href="bower_components/core-ajax/core-ajax.html">
    <link rel="import" href="bower_components/core-header-panel/core-header-panel.html">
    <link rel="import" href="bower_components/core-drawer-panel/core-drawer-panel.html">
    <link rel="import" href="bower_components/core-scaffold/core-scaffold.html">
    <link rel="import" href="bower_components/paper-button/paper-button.html">
    <link rel="import" href="bower_components/paper-input/paper-input.html">
    <link rel="import" href="bower_components/paper-menu-button/paper-menu-button.html">
    <link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
    <link rel="import" href="bower_components/paper-dropdown/paper-dropdown.html">
    <link rel="import" href="bower_components/paper-item/paper-item.html">
    <link rel="import" href="bower_components/ajax-file-input/ajax-file-input.html">
    <link rel="import" href="elements/html-echo/html-echo.html">
    <link rel="import" href="elements/dashboard-records/dashboard-records.html">
    <style>
        core-list {
            height: 200px;
        }
        .open-below {
            top: 38px;
        }
        .UserItem {
            color: black;
        }
        paper-dropdown-menu /deep/ #label {
            background: transparent;
            color: white;
        }
        paper-dropdown-menu /deep/ #arrow {
            background: transparent;
            color: white;
        }
        paper-dropdown-menu {
            border-bottom: none;
        }

    </style>
</head>
<body>

<template id="auto-bind" is="auto-binding">
    <core-scaffold>

        <core-header-panel navigation flex mode="seamed">
            <core-toolbar>
                <core-icon icon="menu"></core-icon>
                <span>Team Work</span></core-toolbar>
            <core-menu theme="core-light-theme">
                <core-item icon="dashboard" label="Dashboard"></core-item>
                <core-item icon="event" label="Calendar"></core-item>
            </core-menu>
        </core-header-panel>
        <div tool>Dashboard</div>
        <div tool horizontal layout flex end-justified class="bottom">
            <core-ajax
                auto='true'
                method="GET"
                url="/platform/users"
                handleAs="json"
                response="{{users}}"
                on-core-complete="{{afterGetUsers}}"
                ></core-ajax>
            
            <paper-dropdown-menu class='userDropDownMenu' label="{{currentUser}}" on-core-select='{{onUserSelect}}'>
                <paper-dropdown class="dropdown">
                  <core-menu>
                    <template repeat="{{users}}">
                      <paper-item class='UserItem'>{{name}}</paper-item>
                    </template>
                  </core-menu>
                </paper-dropdown>
            </paper-dropdown-menu>

            <paper-menu-button style='padding-top: 20px'>
                <paper-icon-button icon="apps" noink></paper-icon-button>
                <paper-dropdown class="dropdown" halign="right" style="color:#000;">
                    <core-menu class="menu">
                        <paper-input label="Search plugin"></paper-input>
                        <paper-item>Vote</paper-item>
                        <paper-item>Questionnaire</paper-item>
                        <paper-item>Brain Writing</paper-item>
                    </core-menu>
                </paper-dropdown>
            </paper-menu-button>
        </div>
        <div fit class="container">
            <dashboard-records id='dashboardMain'></dashboard-records>
        </div>
    </core-scaffold>
</template>
<script>
    var autoBind = document.querySelector('#auto-bind');
    var userNameMap = {};
    autoBind.addEventListener('template-bound', function() {
        autoBind.afterGetUsers = function (){
            if (autoBind.users.length > 0){
                autoBind.currentUser = autoBind.users[0].name;
            }
            autoBind.users.forEach(function(user){
                userNameMap[user.name] = user;
            });
        }
        autoBind.onUserSelect = function (e){
            if (e.detail.isSelected){
               this.$.dashboardMain.currentUserId = userNameMap[e.detail.item.innerText].id;
            }
        }
    });
</script>
</body>
</html>