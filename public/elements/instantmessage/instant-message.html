<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/core-style/core-style.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-action-dialog.html">
<link rel="import" href="../../bower_components/paper-input/paper-autogrow-textarea.html">

<link rel="import" href="../../../home-container.html">
<link rel="import" href="../display-message/display-message.html">

<polymer-element name="instant-message" attributes="channelName">
    <template>
        <link rel="stylesheet" type="text/css" href="instant-message.css">
        <core-style ref="theme"></core-style>
        <home-container>
            <div class="mainBackground" horizontal layout fit>
                <paper-action-dialog id="connectingDialog" backdrop autoCloseDisabled layered="false">
                    <p>{{connectinStatus}}</p>
                </paper-action-dialog>
                <div id="historyAndInput" four flex vertical layout class="mainBgColor">

                    <div id="history" flex>
                        <template repeat="{{m in messages}}">
                            <display-message user="{{m.userId}}" text="{{m.text}}" on-loaded="{{messageLoaded}}"
                                             messageStatus="{{m.messageStatus}}" updatedAt="{{m.updatedAt}}"
                                             on-ready="{{messageReady}}"></display-message>
                        </template>
                    </div>

                    <div class="inputbox" on-tap="{{boxTapped}}">
                        <div layout horizontal>
                            <paper-autogrow-textarea id="messageInput" maxRows="6" on-keydown="{{keyDown}}"
                                                     on-input="{{inputChanging}}" flex>
                                <textarea row="1" id="textInput" value="{{message}}"></textarea>
                            </paper-autogrow-textarea>
                        </div>
                    </div>
                </div>

                <div flex>
                    <div id="groupChannel">
                        <h3 class="secondColor">Group Channel</h3>
                        <template repeat="{{ g in group }}">
                            <paper-item on-click="{{ handleChannelSelect }}" hash="{{g.name}}">{{ g.name }}</paper-item>
                        </template>
                    </div>
                    <div id="directMessage">
                        <h3 class="secondColor">Direct Message</h3>
                        <template repeat="{{ g in private }}">
                            <paper-item on-click="{{ handleChannelSelect }}" hash="{{'@'+g.displayName}}">{{
                                g.displayName }}
                            </paper-item>
                        </template>
                    </div>
                </div>
            </div>

            <paper-action-dialog id="userIdDialog" heading="Dialog Title">
                <paper-input value="{{userId}}"></paper-input>
                <paper-button affirmative on-click="{{userLogin}}">Accept</paper-button>
            </paper-action-dialog>
        </home-container>
    </template>

    <script src="../../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../../bower_components/async/lib/async.js"></script>
    <script src="../../bower_components/lodash/dist/lodash.min.js"></script>
    <script src="instant-message.web.js"></script>
</polymer-element>