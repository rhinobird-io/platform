<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../app-globals/app-globals.html">
<link rel="import" href="avatar-image.html">

<polymer-element name="member-element" attributes="userid username menu imagesize view borderRadius">
    <template>
        <style>

            :host.small {
                font-size: small;
            }

            .title {
                font-size: small;
                color: dimgrey;
            }

            ::content .content {
                word-wrap: break-word;
                padding-left: 5px;
                /*width: 300px;*/
            }

            a:visited {
                color: blue;
            }
        </style>
        <div>
            <template if="{{!view || view == 'default'}}">
                <div class="element pointer" horizontal layout center>
                    <template if="{{menu}}">
                        <a target="_blank" href="#/member/{{user.id}}">
                            <avatar-image userid="{{user.id}}" size="{{imagesize}}"
                                      borderRadius="{{borderRadius}}"></avatar-image>
                        </a>
                    </template>
                    <template if="{{!menu}}">
                        <avatar-image userid="{{user.id}}" size="{{imagesize}}"
                                          borderRadius="{{borderRadius}}"></avatar-image>
                    </template>
                    <div>
                        <template if="{{menu}}">
                            <a target="_blank" href="#/member/{{user.id}}" style="margin: 5px">{{user.realname}}</a>
                        </template>
                        <template if="{{!menu}}">
                            <span style="margin: 5px">{{user.realname}}</span>
                        </template>
                    </div>
                </div>
            </template>
            <template if="{{view && view != 'default'}}">
                <div class="element" horizontal layout>
                    <template if="{{menu}}">
                        <a target="_blank" href="#/member/{{user.id}}">
                            <avatar-image userid="{{user.id}}" size="{{imagesize}}"
                                      style="margin-top: 5px"
                                      borderRadius="{{borderRadius}}"></avatar-image>
                        </a>
                    </template>
                    <template if="{{!menu}}">
                            <avatar-image userid="{{user.id}}" size="{{imagesize}}"
                                          style="margin-top: 5px"
                                          borderRadius="{{borderRadius}}"></avatar-image>
                    </template>
                    <div vertical layout style="margin-left: 5px">
                        <div horizontal layout center class="pointer">
                            <template if="{{menu}}">
                                <a target="_blank" href="#/member/{{user.id}}" style="margin: 5px">{{user.realname}}</a>
                            </template>
                            <template if="{{!menu}}">
                                <span style="margin: 5px">{{user.realname}}</span>
                            </template>
                            <div class="title" flex>
                                <content select=".title"></content>
                            </div>
                        </div>
                        <content select=".content"></content>
                    </div>
                </div>
            </template>
        </div>
        <app-globals id="globals" on-gravatar-ready="{{appGlobalReadyCallback}}"></app-globals>
    </template>
    <script>
        Polymer("member-element", {
            domReady: function () {
                if (this.view && this.view != 'default' && !this.imagesize) {
                    this.imagesize = 36;
                }
                if (this.userid) {
                    this.$.globals.getGravatarById(this.userid);
                } else if (this.username) {
                    this.$.globals.getGravatarByName(this.username);
                }
            },

            useridChanged: function (oldValue, newValue) {
                this.$.globals.getGravatarById(newValue);
            },

            usernameChanged: function (oldValue, newValue) {
                this.$.globals.getGravatarByName(newValue);
            },

            appGlobalReadyCallback: function () {
                if (this.userid) {
                    this.user = this.$.globals.values.memberCacheId[this.userid];
                } else {
                    this.user = this.$.globals.values.memberCacheName[this.username];
                }
            }
        });
    </script>
</polymer-element>
