<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../app-globals/app-globals.html">
<link rel="import" href="avatar-image.html">

<polymer-element name="member-element" attributes="userid username menu imagesize view">
    <template>
        <style>

            :host.small {
                font-size: small;
            }

            .title {
                font-size: small;
                color:dimgrey;
            }

            ::content .content {
                word-wrap: break-word;
                /*width: 300px;*/
            }

            avatar-image /deep/ img {
                -webkit-border-radius: 4px;
                -moz-border-radius: 4px;
                border-radius: 4px;
            }
        </style>
        <template if="{{menu}}">
            <div>
                <template if="{{!view || view == 'default'}}">
                    <div class="element" horizontal layout center>
                        <avatar-image userid="{{userid}}" username="{{username}}" size="{{imagesize}}"></avatar-image>
                        <template if="{{userid}}">
                            <span style="margin: 5px">{{$.globals.values.memberCache[userid].username}}</span>
                        </template>
                        <template if="{{username}}">
                            <span style="margin: 5px">{{username}}</span>
                        </template>
                    </div>
                </template>
                <template if="{{view && view != 'default'}}">
                    <div class="element" horizontal layout>
                        <avatar-image userid="{{userid}}" username="{{username}}" size="{{imagesize}}" on-click="{{toggle}}"></avatar-image>
                        <div vertical layout style="margin-left: 5px">
                            <div horizontal layout center on-click="{{toggle}}">
                                <template if="{{userid}}">
                                    <span style="margin: 5px">{{$.globals.values.memberCache[userid].username}}</span>
                                </template>
                                <template if="{{username}}">
                                    <span style="margin: 5px">{{username}}</span>
                                </template>
                                <div class="title" flex>
                                    <content select=".title"></content>
                                </div>
                            </div>
                            <content select=".content"></content>
                        </div>
                    </div>
                </template>
                <paper-dropdown class="dropdown" style="color:#000">
                <core-menu class="menu">
                    <core-item>Direct Message</core-item>
                    <core-item>View Profile</core-item>
                </core-menu>
                </paper-dropdown>
            </div>
        </template>

        <template if="{{!menu}}">
            <template if="{{!view || view == 'default'}}">
                <div class="element" horizontal layout center>
                    <avatar-image userid="{{userid}}" username="{{username}}" size="{{imagesize}}"></avatar-image>
                    <template if="{{userid}}">
                        <span style="margin: 5px">{{$.globals.values.memberCache[userid].username}}</span>
                    </template>
                    <template if="{{username}}">
                        <span style="margin: 5px">{{username}}</span>
                    </template>
                </div>
            </template>
            <template if="{{view && view != 'default'}}">
                <div class="element" horizontal layout>
                    <avatar-image userid="{{userid}}" username="{{username}}" size="{{imagesize}}"></avatar-image>
                    <div vertical layout style="margin: 5px">
                        <div horizontal layout center>
                            <template if="{{userid}}">
                                <span style="margin: 5px">{{$.globals.values.memberCache[userid].username}}</span>
                            </template>
                            <template if="{{username}}">
                                <span style="margin: 5px">{{username}}</span>
                            </template>
                            <div class="title">
                                <content select=".title"></content>
                            </div>
                        </div>
                        <content select=".content" ></content>
                    </div>
                </div>
            </template>
        </template>
        <app-globals id="globals"></app-globals>
    </template>
    <script>
        Polymer("member-element", {

            domReady: function() {
                if (this.view && this.view != 'default' && !this.imagesize) {
                    this.imagesize = 36;
                }
            },

            appGlobalReadyCallback: function() {
                if (this.userid) {
                    this.gravatar = this.$.globals.values.memberCache[this.userid];
                } else {
                    this.gravatar = this.$.globals.values.memberCache[this.username];
                }
            },

            toggle: function(event, detail, target) {
                if (!this.dropdown) {
                    this.dropdown = this.shadowRoot.querySelector('paper-dropdown');
                }
                this.dropdown && this.dropdown.toggle();
            }
        });
    </script>
</polymer-element>