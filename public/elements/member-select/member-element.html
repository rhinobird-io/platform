<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">


<polymer-element name="member-element" attributes="userid">
    <template>
        <style>

            :host.small {
                font-size: small;
            }

            img {
                width: 1em;
                height: 1em;
            }
        </style>
        <core-ajax id="getGravatar"
                   url="/platform/gravatar/{{userid}}"
                   handleAs="json"
                   on-core-response="{{handleResponse}}"></core-ajax>
        <div class="element" horizontal layout center>
            <img id="image"/> <span style="margin: 2px">{{gravatar.username}}</span>
        </div>

    </template>
    <script>
        var memberCache = {};
        Polymer({
            useridChanged: function (oldValue, newValue) {
                if (!newValue) {
                    this.gravatar = {};
                } else {
                    this.gravatar = memberCache[newValue];
                    if (!this.gravatar) {
                        this.$.getGravatar.go();
                    } else {
                        this.$.image.src = this.gravatar.url + "?d=identicon&s=20";
                    }
                }

            },
            handleResponse: function (event, detail, target) {
                this.gravatar = detail.response;
                memberCache[this.user_id] = detail.response;
                this.$.image.src = this.gravatar.url + "?d=identicon&s=20";
            }
        });
    </script>
</polymer-element>