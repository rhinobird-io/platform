<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../app-globals/app-globals.html">
<link rel="import" href="avatar-image.html">

<polymer-element name="member-element" attributes="userid username menu imagesize view borderRadius">
    <template>
        <style>

            :host.small {
                font-size: small;
            }

            .title {
                font-size: small;
                color:dimgrey;
            }

            ::content .content {
                word-wrap: break-word;
                padding-left: 5px;
                /*width: 300px;*/
            }

            .pointer {
                cursor: pointer;
            }
        </style>
        <template if="{{menu}}">
            <div>
                <template if="{{!view || view == 'default'}}">
                    <div class="element pointer" horizontal layout center>
                        <avatar-image userid="{{userid}}" username="{{username}}" size="{{imagesize}}" on-click="{{toggle}}"
                                      borderRadius="{{borderRadius}}"></avatar-image>
                        <div on-click="{{toggle}}">
                            <template if="{{userid}}">
                                <span style="margin: 5px">{{$.globals.values.memberCacheId[userid].realname}}</span>
                            </template>
                            <template if="{{username}}">
                                <span style="margin: 5px">{{$.globals.values.memberCacheName[username].realname}}</span>
                            </template>
                        </div>
                    </div>
                </template>
                <template if="{{view && view != 'default'}}">
                    <div class="element" horizontal layout>
                        <avatar-image userid="{{userid}}" username="{{username}}" size="{{imagesize}}" on-click="{{toggle}}"
                                      class="pointer" style="margin-top: 5px" borderRadius="{{borderRadius}}"></avatar-image>
                        <div vertical layout style="margin-left: 5px">
                            <div horizontal layout center on-click="{{toggle}}" class="pointer">
                                <template if="{{userid}}">
                                    <span style="margin: 5px">{{$.globals.values.memberCacheId[userid].realname}}</span>
                                </template>
                                <template if="{{username}}">
                                    <span style="margin: 5px">{{$.globals.values.memberCacheName[username].realname}}</span>
                                </template>
                                <div class="title" flex>
                                    <content select=".title"></content>
                                </div>
                            </div>
                            <content select=".content"></content>
                        </div>
                    </div>
                </template>
                <paper-dropdown class="dropdown member-element-dropdown" style="color:#000" layered>
                    <core-menu class="menu">
                        <core-item>Direct Message</core-item>
                        <core-item>View Profile</core-item>
                    </core-menu>
                </paper-dropdown>
            </div>
        </template>

        <template if="{{!menu}}">
            <template if="{{!view || view == 'default'}}">
                <div class="element" horizontal layout center>
                    <avatar-image userid="{{userid}}" username="{{username}}" size="{{imagesize}}"
                                  borderRadius="{{borderRadius}}"></avatar-image>
                    <template if="{{userid}}">
                        <span style="margin: 5px">{{$.globals.values.memberCacheId[userid].realname}}</span>
                    </template>
                    <template if="{{username}}">
                        <span style="margin: 5px">{{$.globals.values.memberCacheName[username].realname}}</span>
                    </template>
                </div>
            </template>
            <template if="{{view && view != 'default'}}">
                <div class="element" horizontal layout>
                    <avatar-image userid="{{userid}}" username="{{username}}" size="{{imagesize}}"
                                  borderRadius="{{borderRadius}}"></avatar-image>
                    <div vertical layout style="margin: 5px">
                        <div horizontal layout center>
                            <template if="{{userid}}">
                                <span style="margin: 5px">{{$.globals.values.memberCacheId[userid].realname}}</span>
                            </template>
                            <template if="{{username}}">
                                <span style="margin: 5px">{{$.globals.values.memberCacheName[username].realname}}</span>
                            </template>
                            <div class="title">
                                <content select=".title"></content>
                            </div>
                        </div>
                        <content select=".content" ></content>
                    </div>
                </div>
            </template>
        </template>
        <app-globals id="globals"></app-globals>
    </template>
    <script>
        Polymer("member-element", {
            domReady: function() {
                if (this.view && this.view != 'default' && !this.imagesize) {
                    this.imagesize = 36;
                }
            },

            appGlobalReadyCallback: function() {
                if (this.userid) {
                    this.gravatar = this.$.globals.values.memberCacheId[this.userid];
                } else {
                    this.gravatar = this.$.globals.values.memberCacheName[this.username];
                }
            },

            toggle: function(event, detail, target) {
                if (!this.dropdown) {
                    this.dropdown = this.shadowRoot.querySelector('paper-dropdown');
                }

                var dropdownMenus = document.querySelectorAll('body /deep/ .member-element-dropdown');
                for (var i = 0; i < dropdownMenus.length; i++) {
                    if (dropdownMenus[i] != this.dropdown) {
                        dropdownMenus[i].close();
                    }
                }

                if (this.dropdown) {
                    this.dropdown.toggle();
                }
            }
        });
    </script>
</polymer-element>
