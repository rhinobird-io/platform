<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">


<polymer-element name="member-element" attributes="user_id">
    <template>
        <style>
            .element {
                font-size: small;
                color:dimgrey;
            }
        </style>
        <core-ajax id="getGravatar"
                   auto
                   url="/platform/gravatar/{{user_id}}"
                   handleAs="json"
                   response="{{gravatar}}"></core-ajax>
        <div class="element" horizontal layout center>
            <img src="{{gravatar.url}}?d=identicon&s=20" />  <span style="margin: 2px">{{gravatar.username}}</span>
        </div>

    </template>
    <script>
        var memberCache = {};
        Polymer({
            useridChanged: function (oldValue, newValue) {
                if (!newValue) {
                    this.gravatar = {};
                } else {
                    this.gravatar = memberCache[newValue];
                    if (!this.gravatar) {
                        this.$.getGravatar.go();
                    } else {
                        this.$.image.src = this.gravatar.url + "?d=identicon&s=20";
                    }
                }

            },
            handleResponse: function (event, detail, target) {
                this.gravatar = detail.response;
                memberCache[this.user_id] = detail.response;
                this.$.image.src = this.gravatar.url + "?d=identicon&s=20";
            }
        });
    </script>
</polymer-element>