<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../app-globals/app-globals.html">
<link rel="import" href="avatar-image.html">

<polymer-element name="x-trigger" relative="" on-tap="{{toggle}}" noink="">
    <template>
        <shadow></shadow>
        <content></content>
    </template>
    <script>
        Polymer({
            toggle: function(event, detail, target) {
                if (!this.dropdown) {
                    this.dropdown = this.querySelector('paper-dropdown');
                }
                this.dropdown && this.dropdown.toggle();
            }
        });
    </script>
</polymer-element>

<polymer-element name="member-element" attributes="userid menu imagesize view">
    <template>
        <style>

            :host.small {
                font-size: small;
            }

            .title {
                font-size: small;
                color:dimgrey;
            }

        </style>
        <core-ajax id="getGravatar"
                   url="/platform/gravatar/{{userid}}"
                   handleAs="json"
                   on-core-response="{{handleResponse}}"></core-ajax>
        <template if="{{menu}}">
            <div>
                <template if="{{!view || view == 'default'}}">
                    <div class="element" horizontal layout center>
                        <avatar-image userid="{{userid}}" size="{{imagesize}}" on-avatar-ready="{{avatarReady}}"></avatar-image><span style="margin: 5px">{{gravatar.username}}</span>
                    </div>
                </template>
                <template if="{{view && view != 'default'}}">
                    <div class="element" horizontal layout>
                        <avatar-image userid="{{userid}}" size="{{imagesize}}" on-avatar-ready="{{avatarReady}}" on-click="{{toggle}}"></avatar-image>
                        <div vertical layout style="margin: 5px">
                            <div horizontal layout class="title" on-click="{{toggle}}">
                                <span style="margin-right: 5px">{{gravatar.username}}</span>
                                <content select=".title"></content>
                            </div>
                            <content select=".content" ></content>
                        </div>
                    </div>
                </template>
                <paper-dropdown class="dropdown" style="color:#000">
                <core-menu class="menu">
                    <core-item>Direct Message</core-item>
                    <core-item>View Profile</core-item>
                </core-menu>
                </paper-dropdown>
            </div>
        </template>

        <template if="{{!menu}}">
            <template if="{{!view || view == 'default'}}">
                <div class="element" horizontal layout center>
                    <avatar-image userid="{{userid}}" size="{{imagesize}}" on-avatar-ready="{{avatarReady}}"></avatar-image><span style="margin: 5px">{{gravatar.username}}</span>
                </div>
            </template>
            <template if="{{view && view != 'default'}}">
                <div class="element" horizontal layout>
                    <avatar-image userid="{{userid}}" size="{{imagesize}}" on-avatar-ready="{{avatarReady}}"></avatar-image>
                    <div vertical layout style="margin: 5px">
                        <div horizontal layout class="title">
                            <span style="margin-right: 5px">{{gravatar.username}}</span>
                            <content select=".title"></content>
                        </div>
                        <content select=".content" ></content>
                    </div>
                </div>
            </template>
        </template>
        <app-globals id="globals"></app-globals>
    </template>
    <script>
        Polymer("member-element", {

            domReady: function() {
                if (this.view && this.view != 'default' && !this.imagesize) {
                    this.imagesize = 36;
                }
            },

            avatarReady: function() {
                this.gravatar = this.$.globals.values.memberCache[this.userid];
            },

            toggle: function(event, detail, target) {
                if (!this.dropdown) {
                    this.dropdown = this.shadowRoot.querySelector('paper-dropdown');
                }
                this.dropdown && this.dropdown.toggle();
            }
        });
    </script>
</polymer-element>