<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../app-globals/app-globals.html">

<polymer-element name="avatar-image" attributes="userid username size default">
    <template>
        <style>

            :host.small {
                font-size: small;
            }
        </style>

        <template if="{{userid && $.globals.values.memberCache[userid] && default && size}}">
            <img src="{{$.globals.values.memberCache[userid].url}}?d={{default}}&s={{size}}" width="{{size}}" height="{{size}}"/>
        </template>

        <template if="{{username && $.globals.values.memberCache[username] && default && size}}">
            <img src="{{$.globals.values.memberCache[username].url}}?d={{default}}&s={{size}}" width="{{size}}" height="{{size}}"/>
        </template>
        <app-globals id="globals"></app-globals>
    </template>
    <script>
        (function() {

            Polymer({

                domReady: function() {
                    if (!this.size) {
                        this.size = 15;
                    }

                    if (!this.default) {
                        this.default = "identicon";
                    }
                },

                useridChanged: function (oldValue, newValue) {
                    this.changeAction(oldValue, newValue);
                },

                usernameChanged: function (oldValue, newValue) {
                    this.changeAction(oldValue, newValue);
                },

                changeAction: function(oldValue, newValue) {

                    if (!newValue) {
                        this.gravatar = {};
                    } else if (this.$.globals.values.memberCache) {
                        this.gravatar = this.$.globals.values.memberCache[newValue];
                        if (!this.gravatar) {
                            if (this.userid) {
                                this.$.globals.getGravatarById(this.userid);
                            } else if (this.username) {
                                this.$.globals.getGravatarById(this.username);
                            }
                        }
                    }
                }
            });
        })();
    </script>
</polymer-element>