<link rel="import" href="home-container.html">
<link rel="import" href="bower_components/core-icons/core-icons.html">
<link rel="import" href="bower_components/core-item/core-item.html">
<link rel="import" href="bower_components/polymer-filters/polymer-filters.html">
<link rel="import" href="elements/app-globals/app-globals.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="bower_components/core-list/core-list.html">
<link rel="import" href="elements/member-select/member-element.html">
<link rel="import" href="elements/smart-time-display/smart-time-display.html">

<polymer-element name="snapshot-record" attributes="record">
    <template>
        <style>
            .time {
                font-size: small;
                color:dimgrey;
                margin-left: 10px;
            }
        </style>
        <core-item>
            <div>
                <div horizontal layout center>
                    <template if="{{record.event_type == 'add_user' || record.event_type == 'remove_user'}}">
                        <member-element userid="{{record.member_user_id}}"></member-element>
                    </template>

                    <template if="{{record.event_type == 'add_team'}}">
                        <core-icon icon="social:people" style="width:16px; height:16px"></core-icon>
                        <span style="margin: 5px">{{$.globals.values.teamCache[record.member_team_id].name}}</span>
                    </template>

                    {{message}}
                    <span class="time">
                        <smart-time-display
                                from="{{record.created_at}}"
                                to="{{record.created_at}}">
                        </smart-time-display>
                        ago
                    </span>

                </div>


                <app-globals id="globals"></app-globals>
            </div>
        </core-item>
    </template>
    <script>
        Polymer("snapshot-record", {
            recordChanged: function() {
                switch (this.record.event_type) {
                    case "create":
                        this.message = "Team has been created";
                        break;
                    case "add_user":
                        this.message = " has been added to team ";
                        break;
                    case "remove_user":
                        this.message = " has been removed from team ";
                        break;
                    case "add_team":
                        this.message = " has been added to team";
                        this.$.globals.getTeamById(this.record.member_team_id);
                        break;
                    default:
                        this.message = "unknown operation";
                }
            }
        })
    </script>
</polymer-element>

<polymer-element name="team-snapshot" attributes="teamId">
    <template>
        <style>
            core-list {
                height: 600px;
            }
        </style>
        <home-container>
            <core-ajax auto
                       url="/platform/teams/{{teamId}}/snapshot"
                       handleAs="json"
                       response="{{records}}"></core-ajax>
            <div class="title">
                Team History
            </div>
            <div class="content">
                <core-list data="{{records}}">
                    <template>
                        <snapshot-record record="{{model}}"></snapshot-record>
                    </template>
                </core-list>
            </div>
        </home-container>
    </template>
    <script>
        Polymer("team-snapshot", {
        });
    </script>
</polymer-element>